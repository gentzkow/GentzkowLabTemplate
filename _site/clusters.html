<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/GentzkowLabTemplateFork/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/GentzkowLabTemplateFork/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(1)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(1) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(3) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(3) > ul > li:nth-child(1) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(3) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list { display: block; } </style> <script src="/GentzkowLabTemplateFork/assets/js/vendor/lunr.min.js"></script> <script src="/GentzkowLabTemplateFork/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Research Clusters | Gentzkow Lab Practice Tasks</title> <meta name="generator" content="Jekyll v3.9.5" /> <meta property="og:title" content="Research Clusters" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A comprehensive guide for research assistants working with the Gentzkow Lab template" /> <meta property="og:description" content="A comprehensive guide for research assistants working with the Gentzkow Lab template" /> <link rel="canonical" href="http://0.0.0.0:4000/GentzkowLabTemplateFork/clusters.html" /> <meta property="og:url" content="http://0.0.0.0:4000/GentzkowLabTemplateFork/clusters.html" /> <meta property="og:site_name" content="Gentzkow Lab Practice Tasks" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Research Clusters" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A comprehensive guide for research assistants working with the Gentzkow Lab template","headline":"Research Clusters","url":"http://0.0.0.0:4000/GentzkowLabTemplateFork/clusters.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/GentzkowLabTemplateFork/" class="site-title lh-tight"> Gentzkow Lab Practice Tasks </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/GentzkowLabTemplateFork/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Tasks category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/GentzkowLabTemplateFork/tasks.html" class="nav-list-link">Tasks</a><ul class="nav-list"><li class="nav-list-item"><a href="/GentzkowLabTemplateFork/task1.html" class="nav-list-link">Task 1 - GentzkowLabTemplate</a></li><li class="nav-list-item"><a href="/GentzkowLabTemplateFork/task2.html" class="nav-list-link">Task 2 - Sherlock Extension</a></li><li class="nav-list-item"><a href="/GentzkowLabTemplateFork/task3.html" class="nav-list-link">Task 3 - Python-based Archived Template</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/GentzkowLabTemplateFork/reference.html" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/GentzkowLabTemplateFork/clusters.html" class="nav-list-link">Research Clusters</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Setup category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/GentzkowLabTemplateFork/setup.html" class="nav-list-link">Setup</a><ul class="nav-list"><li class="nav-list-item"><a href="/GentzkowLabTemplateFork/setup_instr.html" class="nav-list-link">Software Setup</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Gentzkow Lab Practice Tasks" aria-label="Search Gentzkow Lab Practice Tasks" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/GentzkowLabTemplateFork/reference.html">Reference</a></li> <li class="breadcrumb-nav-list-item"><span>Research Clusters</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="research-clusters"> <a href="#research-clusters" class="anchor-heading" aria-labelledby="research-clusters"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Research Clusters </h1> <p>This guide provides comprehensive information about working with high-performance computing clusters, particularly Stanford’s Sherlock cluster. Research clusters allow us to outsource computationally expensive jobs to external computer banks.</p> <h2 id="sherlock-overview"> <a href="#sherlock-overview" class="anchor-heading" aria-labelledby="sherlock-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sherlock Overview </h2> <p><strong>Sherlock</strong> is a shared computer cluster funded by Stanford’s Provost and Dean of Research. It is available to Stanford faculty and affiliates. Computing clusters such as Sherlock allow us to outsource computationally expensive jobs to external computer banks.</p> <h2 id="slurm-job-scheduler"> <a href="#slurm-job-scheduler" class="anchor-heading" aria-labelledby="slurm-job-scheduler"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SLURM Job Scheduler </h2> <p>The <strong>Simple Linux Utility for Resource Management (SLURM)</strong> is used by most computing clusters, including Sherlock. One can find a comprehensive guide on SLURM through its <a href="https://slurm.schedmd.com/">homepage</a> and a quick cheatsheet on SLURM at this <a href="https://slurm.schedmd.com/quickstart.html">Slurm 101 website</a>.</p> <p>The basic workflow in these clusters is the same as in the local computer. One should always check code carefully before submissions.</p> <h2 id="getting-started"> <a href="#getting-started" class="anchor-heading" aria-labelledby="getting-started"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Getting Started </h2> <h3 id="logging-in-to-sherlock"> <a href="#logging-in-to-sherlock" class="anchor-heading" aria-labelledby="logging-in-to-sherlock"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Logging in to Sherlock </h3> <p>You can access Sherlock from your terminal by running:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh SUNetID@login.sherlock.stanford.edu
</code></pre></div></div> <p>When you first log in, check this <a href="https://www.sherlock.stanford.edu/docs/getting-started/">Sherlock guide</a> to set up credentials.</p> <h3 id="installing-and-loading-software"> <a href="#installing-and-loading-software" class="anchor-heading" aria-labelledby="installing-and-loading-software"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installing and Loading Software </h3> <h4 id="a-loading-software"> <a href="#a-loading-software" class="anchor-heading" aria-labelledby="a-loading-software"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> A) Loading Software </h4> <p>Upon logging into the cluster, you can install desired software by inputting the following commands:</p> <ul> <li>Use <code class="language-plaintext highlighter-rouge">module avail</code> or <code class="language-plaintext highlighter-rouge">module spider</code> to see if the software is already installed in the cluster, and which versions are available. If so, use <code class="language-plaintext highlighter-rouge">module load &lt;application/version&gt;</code>.</li> <li>Note that some applications are only available on distinct module categories (i.e., system as opposed to chemistry).</li> <li>In most cases, you will want to load modules directly from the system category (i.e., <code class="language-plaintext highlighter-rouge">module load system &lt;application/version&gt;</code>).</li> <li>Generally, you will want to load the latest versions of these modules in Sherlock: Stata, Lyx, texlive/2019, Git, and Git LFS.</li> <li>If you are using miniconda (as recommended), do not load Python or R modules locally from Sherlock.</li> <li>If you are not using miniconda, you should additionally load <code class="language-plaintext highlighter-rouge">R/&lt;latest_version&gt;</code> and <code class="language-plaintext highlighter-rouge">Python/3.6.1</code>.</li> <li>For more information on miniconda, see <a href="#installing-miniconda-on-sherlock">Installing miniconda on Sherlock</a> below.</li> </ul> <h4 id="b-installing-software"> <a href="#b-installing-software" class="anchor-heading" aria-labelledby="b-installing-software"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> B) Installing Software </h4> <p>Installing new software in Sherlock is not straightforward, and should be carefully considered. Sherlock does not enable access to standard installation procedures, such as <code class="language-plaintext highlighter-rouge">brew install</code> or <code class="language-plaintext highlighter-rouge">sudo install</code>. Furthermore, Sherlock operates on a Linux OS, so software packages should be supported in Linux. You can learn more about software installations through <a href="https://www.sherlock.stanford.edu/docs/software/installing/">Sherlock’s user guide</a>.</p> <p>Generally, software should be installed in your local <code class="language-plaintext highlighter-rouge">$HOME</code> directory. If the entire GS-Lab team will require usage, software should be installed in <code class="language-plaintext highlighter-rouge">$GROUP_HOME</code>. Check with a lab member before installing shared software.</p> <ul> <li>Individual lab members should specify file paths where their shared applications are located in their <code class="language-plaintext highlighter-rouge">~/.bash_profile</code>.</li> <li>Contact Sherlock Support if the above methods to load local packages fail.</li> </ul> <h2 id="git-github-and-git-lfs-on-sherlock"> <a href="#git-github-and-git-lfs-on-sherlock" class="anchor-heading" aria-labelledby="git-github-and-git-lfs-on-sherlock"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Git, GitHub, and Git LFS on Sherlock </h2> <p>To link GitHub to Sherlock, you will need to generate a new SSH key, and link this to Sherlock. You can follow the instructions <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">here</a>. Ensure you follow the instructions for Linux machines - following the prompts for Mac or Windows will throw errors. Also make sure you add this SSH key on your Sherlock terminal, and not on your local terminal. You will want to maintain separate keys for Sherlock use and local use.</p> <p>To check if you have successfully connected to GitHub, you can run <code class="language-plaintext highlighter-rouge">ssh -T git@github.com</code> (within your Sherlock terminal) to test SSH connection. Following this, you may use standard Git commands in the terminal (i.e., running <code class="language-plaintext highlighter-rouge">git clone &lt;repository SSH link&gt;</code> in your personal directory on <code class="language-plaintext highlighter-rouge">$OAK</code> will duplicate a remote GitHub repository).</p> <p>As in the standard template repository, we will need to use git lfs for many projects. To activate git lfs and clone a repository:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ml system git/&lt;latest_version&gt;
ml system git-lfs/&lt;latest_version&gt;
git lfs <span class="nb">install</span>
./setup/lfs_setup.sh
git clone git@github.com:&lt;org_name&gt;/&lt;repo_name&gt;.git
</code></pre></div></div> <h2 id="installing-miniconda-on-sherlock"> <a href="#installing-miniconda-on-sherlock" class="anchor-heading" aria-labelledby="installing-miniconda-on-sherlock"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installing Miniconda on Sherlock </h2> <p>As discussed above, installing remote software is not generally recommended in Sherlock. However, you will need to install miniconda in order to follow the standard template process. If you do not wish to run conda on Sherlock, see the instructions in <code class="language-plaintext highlighter-rouge">/setup/dependencies.md</code>. You will need to load all relevant modules and package versions locally in Sherlock.</p> <p>To install miniconda on Sherlock:</p> <ol> <li>Visit the <a href="https://docs.conda.io/en/latest/miniconda.html">website hosting source code for miniconda</a>.</li> <li>Copy the web address for the installation code script to your local computer. The suffix for this web address should be <code class="language-plaintext highlighter-rouge">.sh</code>.</li> <li>On Sherlock: navigate to your <code class="language-plaintext highlighter-rouge">$HOME</code> user repository (you can simply run the <code class="language-plaintext highlighter-rouge">cd</code> command in terminal to do so).</li> <li>Load the curl module with <code class="language-plaintext highlighter-rouge">module spider curl</code>, and ensure it is up to date by specifying <code class="language-plaintext highlighter-rouge">ml curl &lt;latest version&gt;</code>.</li> <li>Input the command <code class="language-plaintext highlighter-rouge">curl -O &lt;source file link&gt;</code>, where “<source file="" link="" />” refers to the installation file url (e.g., <code class="language-plaintext highlighter-rouge">https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</code>)</li> <li>Request a development node with the command <code class="language-plaintext highlighter-rouge">sdev -m 16G</code> and execute the shell script with <code class="language-plaintext highlighter-rouge">bash &lt;Miniconda3-latest-Linux-x86_64.sh&gt;</code>. Follow the prompts in the <code class="language-plaintext highlighter-rouge">.sh</code> file.</li> </ol> <p><strong>Note</strong>: You will only need to install miniconda once, but you will need to initialize a new conda environment (following the standard procedure in template) whenever you hope to submit a new job.</p> <h2 id="setting-up-the-sherlock-environment"> <a href="#setting-up-the-sherlock-environment" class="anchor-heading" aria-labelledby="setting-up-the-sherlock-environment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setting up the Sherlock Environment </h2> <p>You should follow the protocol defined by the points below to set up your environment. These steps should always be taken prior to submitting a job, and after loading/installing the above software.</p> <p><strong>Note</strong>: The <code class="language-plaintext highlighter-rouge">~/.bash_profile</code> and the <code class="language-plaintext highlighter-rouge">~/.bashrc</code> files serve different purposes. The <code class="language-plaintext highlighter-rouge">~/.bash_profile</code> defines the paths of the software that will be used on an interactive login shell. The <code class="language-plaintext highlighter-rouge">~/.bashrc</code> script is the file that is checked and executed when using a non-login interactive shell. Thus, the <code class="language-plaintext highlighter-rouge">~/.bashrc</code> file is the one that will be checked when you submit a job to Sherlock. Find further information <a href="https://www.gnu.org/software/bash/manual/html_node/Bash-Startup-Files.html">here</a>.</p> <ol> <li>Explicitly specify your Python or conda path at the beginning of your <code class="language-plaintext highlighter-rouge">~/.bashrc</code> script, by setting: <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$OAK</span>/&lt;YourPythonPathInSherlock&gt;/python3.6/site-packages:<span class="nv">$PYTHONPATH</span>
</code></pre></div> </div> <p>or if using conda:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> &lt;YourCondaPathInSherlock&gt;/conda.sh
conda activate &lt;CONDAENVIRONMENT&gt;
</code></pre></div> </div> </li> <li>Ensure you have imported all required modules.</li> <li>Initialize your environment as required by your project (usually in a repository README or wiki).</li> <li>Generally, loading required modules in Sherlock will enable command line usage. There is no need to specify the executables path in a <code class="language-plaintext highlighter-rouge">~/.bash_profile.sh</code> script as we do in template.</li> </ol> <h2 id="accessing-storage-locations-for-sherlock-edits"> <a href="#accessing-storage-locations-for-sherlock-edits" class="anchor-heading" aria-labelledby="accessing-storage-locations-for-sherlock-edits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Accessing Storage Locations for Sherlock Edits </h2> <p>Sherlock provides access to multiple file systems with different storage characteristics. We recommend following the below workflow.</p> <ol> <li>Clone any GitHub directory to one’s personal folder in gentzkow. These can be accessed by running the command <code class="language-plaintext highlighter-rouge">cd $OAK</code> in your Sherlock terminal.</li> <li>Rsync the entire repository and external inputs to SCRATCH.</li> <li>Run the job within SCRATCH.</li> <li>Commit the job.</li> <li>Rsync back to OAK.</li> </ol> <p>In certain circumstances, <code class="language-plaintext highlighter-rouge">L_SCRATCH</code> is preferred to <code class="language-plaintext highlighter-rouge">SCRATCH</code>. This is the case if:</p> <ul> <li>The job involves the creating of will temp files created by scripts.</li> <li>The job involves small (&lt;100GB) files that need to be read/written onto many times in the course of a job.</li> </ul> <p><strong>Note</strong>: If you are working with very large files, it is important to ensure that lab members do not needlessly copy over these files to each of their repositories on Sherlock (in particular, within <code class="language-plaintext highlighter-rouge">$OAK</code>). These files should instead be RSynced once to a shared location, which serves as a relative path for all lab members (for example, in the lab folder in <code class="language-plaintext highlighter-rouge">$OAK</code>).</p> <h2 id="editing-files-in-sherlock"> <a href="#editing-files-in-sherlock" class="anchor-heading" aria-labelledby="editing-files-in-sherlock"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Editing Files in Sherlock </h2> <p>There are four distinct ways to edit files using Sherlock:</p> <h3 id="1-direct-terminal-editing"> <a href="#1-direct-terminal-editing" class="anchor-heading" aria-labelledby="1-direct-terminal-editing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Direct Terminal Editing </h3> <p>You can directly edit files in Sherlock interactively, using a text editor such as <code class="language-plaintext highlighter-rouge">nano</code>, <code class="language-plaintext highlighter-rouge">micro</code>, or <code class="language-plaintext highlighter-rouge">vim</code>.</p> <h3 id="2-local-editing-with-git"> <a href="#2-local-editing-with-git" class="anchor-heading" aria-labelledby="2-local-editing-with-git"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Local Editing with Git </h3> <p>Provided that GitHub integration has been set up, you can make file edits on your local computer in the code editor of your choice, push those changes to a remote repository hosted on GitHub, and then pull those changes down to your personal Sherlock directory in <code class="language-plaintext highlighter-rouge">$OAK</code>.</p> <h3 id="3-visual-studio-code-remote-ssh"> <a href="#3-visual-studio-code-remote-ssh" class="anchor-heading" aria-labelledby="3-visual-studio-code-remote-ssh"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Visual Studio Code Remote SSH </h3> <p>If you use Visual Studio Code, you can install and utilize the “Remote - SSH” extension provided through Microsoft. This extension will allow you to access Sherlock through Visual Studio, and make edits as you might on a local Visual Studio project. You will need to login to Sherlock following the standard process outlined above.</p> <h3 id="4-sshfs-mounting"> <a href="#4-sshfs-mounting" class="anchor-heading" aria-labelledby="4-sshfs-mounting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. SSHFS Mounting </h3> <p>You can set up local editing on Sherlock by following these instructions relating to SSHFS. As an example, you could run the following after installing SSHFS in your local system:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> ~/sherlock_oak  <span class="c"># will create an empty directory in your local $HOME directory.</span>
sshfs &lt;sunet <span class="nb">id</span><span class="o">&gt;</span>@login.sherlock.stanford.edu:/oak/stanford/groups/gentzkow ~/sherlock_oak  <span class="c"># will mount the $OAK research cluster in Sherlock to your empty sherlock_oak folder in $HOME.</span>
</code></pre></div></div> <p>If you choose to utilize the fourth approach, remember to always unmount your folder when you have finished editing. You can utilize the following command to do so: <code class="language-plaintext highlighter-rouge">umount ~/sherlock_oak</code>.</p> <p><strong>Important</strong>: If your Mac goes to sleep and you are still mounted to Sherlock, your computer will continually try to access Sherlock. This will result in your IP address being blacklisted from Sherlock. While this is reversible, we want to avoid this situation if possible.</p> <h2 id="sample-batch-script-for-testing-and-job-submission"> <a href="#sample-batch-script-for-testing-and-job-submission" class="anchor-heading" aria-labelledby="sample-batch-script-for-testing-and-job-submission"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sample Batch Script for Testing and Job Submission </h2> <p>Each bash script you run to submit jobs will differ slightly based on its purpose, the anticipated resources required, and the specified clusters for execution. However, the general format will be similar to the below:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c">#</span>
<span class="c">#SBATCH --job-name=run_all</span>
<span class="c">#SBATCH --time=2:00:00</span>
<span class="c">#SBATCH --mem=50GB</span>
<span class="c">#SBATCH --partition=gentzkow</span>
<span class="c">#SBATCH --mail-type=ALL</span>
<span class="c">#SBATCH --mail-user=&lt;USER&gt;@stanford.edu</span>
<span class="c">#SBATCH --ntasks=1</span>

srun python run_all.py
</code></pre></div></div> <p>For more information on how to submit and run jobs on Sherlock, see the <a href="https://www.sherlock.stanford.edu/docs/getting-started/submitting/">user documentation</a>.</p> <h2 id="stanford-gentzkow-node"> <a href="#stanford-gentzkow-node" class="anchor-heading" aria-labelledby="stanford-gentzkow-node"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stanford Gentzkow Node </h2> <p>MG has purchased resources on Stanford’s Sherlock 2 cluster. Jobs submitted to this partition only compete with other lab members for resources, and interactive jobs can request all available resources. The partition consists of:</p> <ul> <li>A Dell C6320 server with 20 cores, 256G of RAM, and a 200G SSD.</li> </ul> <p>You can submit all of your jobs to multiple partitions. This is done by setting <code class="language-plaintext highlighter-rouge">#SBATCH --partition=gentzkow,hns,normal</code> at the beginning of your sbatch script.</p> <h2 id="stanford-humanities-and-sciences-nodes"> <a href="#stanford-humanities-and-sciences-nodes" class="anchor-heading" aria-labelledby="stanford-humanities-and-sciences-nodes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stanford Humanities and Sciences Nodes </h2> <p>The Humanities and Sciences Dean’s Office at Stanford has purchased Sherlock nodes for its researchers’ exclusive use. These nodes belong to the <code class="language-plaintext highlighter-rouge">hns</code> partition. This partition consists of:</p> <ul> <li>10 CPU nodes, which have 64 GB of RAM and 16 multi-core CPUs.</li> <li><code class="language-plaintext highlighter-rouge">hns_gpu</code>, a graphical processing unit node with 128 GB of RAM, a 8 Tesla K80 GPU @ 1.87 Tflops (double precision) and a 5.60 Tflops GPU (single precision), and 16 CPUs.</li> <li>a large memory node with 1.5 TB of RAM. Job requests that require over 64 GB of RAM are automatically sent to this node.</li> </ul> <p>Access these nodes by adding <code class="language-plaintext highlighter-rouge">-p hns</code> to our job submission requests. Similarly, we can run graphical processing unit (GPU) jobs by adding <code class="language-plaintext highlighter-rouge">-p hns_gpu --gres gpu:1</code> to our request commands.</p> <h2 id="testing-scripts-prior-to-job-submission"> <a href="#testing-scripts-prior-to-job-submission" class="anchor-heading" aria-labelledby="testing-scripts-prior-to-job-submission"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Testing Scripts Prior to Job Submission </h2> <p>There are two steps of testing that you should follow prior to submitting.</p> <ol> <li><strong>Test your bash script</strong> before submitting a job to be sure that the environment is set up correctly. <ul> <li>One way to do this is to have your sbatch script call only a specific lib file. These files gather functions that are used throughout the repository, and hence run quickly. However, they need your environment to be fully working to run and thus serve as a fast check for your setup.</li> </ul> </li> <li><strong>Test your full script</strong> by running it on a subset of the data. You can also interactively test out your code by running the command <code class="language-plaintext highlighter-rouge">sdev -m16GB</code>.</li> </ol> <p>In general, your jobs are assigned a node depending on their priority and the resources needed. If you allocate your job only to the gentzkow partition (see above) then it will run whenever the partition has a free node, regardless of the time or memory requested. However, if you opt for multiple partitions, then the allocation depends on the time and memory requested.</p> <p>Since your environment testing is fast, we suggest that you adjust the time and memory needed and then allocate your job to multiple partitions: <code class="language-plaintext highlighter-rouge">#SBATCH --partition=gentzkow,owners</code> to access whichever is free. Remember to remove the owners partition to run your full job as you do not have priority on it.</p> <h2 id="running-jobs-in-sherlock"> <a href="#running-jobs-in-sherlock" class="anchor-heading" aria-labelledby="running-jobs-in-sherlock"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running Jobs in Sherlock </h2> <p>After setting up your environment and testing your code you can submit a job.</p> <p>Cluster-specific guides on submitting and running jobs can be found <a href="https://www.sherlock.stanford.edu/docs/getting-started/submitting/">here</a> for Sherlock.</p> <p>If you are unsure of whether a job should be submitted to a cluster, first ask another RA and then proceed to MG if necessary.</p> <h2 id="additional-resources"> <a href="#additional-resources" class="anchor-heading" aria-labelledby="additional-resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Additional Resources </h2> <ul> <li><a href="https://www.sherlock.stanford.edu/docs/">Sherlock User Guide</a></li> <li><a href="https://slurm.schedmd.com/">SLURM Documentation</a></li> <li><a href="https://slurm.schedmd.com/quickstart.html">SLURM Quick Start Guide</a></li> </ul> </main> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2024 Gentzkow Lab. Distributed by <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>.</p> <div class="d-flex mt-2"> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
